document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("checkout-form"),e=document.getElementById("checkout-items"),n=document.getElementById("subtotal"),o=document.getElementById("vat"),a=document.getElementById("total"),r=document.getElementById("order-success-modal"),s=document.getElementById("success-close"),c=document.getElementById("success-continue"),d=document.getElementById("order-number");let i=JSON.parse(localStorage.getItem("lejonTkdCart"))||[];function m(){return i.reduce((t,e)=>t+e.price*e.quantity,0)}function l(t){return Math.round(.25*t)}function u(e){e.preventDefault();const n=new FormData(t),o={customer:{firstName:n.get("firstName"),lastName:n.get("lastName"),email:n.get("email"),phone:n.get("phone")},paymentMethod:n.get("paymentMethod"),orderNotes:n.get("orderNotes"),items:i,totals:{subtotal:m(),vat:l(m()),total:m()+l(m())}},a=`LTKD-${(new Date).getFullYear()}-${Math.floor(100+900*Math.random())}`;console.log("Processing order:",o),d&&(d.textContent=a),r&&r.classList.add("active"),i=[],localStorage.setItem("lejonTkdCart",JSON.stringify(i))}function g(){r&&r.classList.remove("active")}0!==i.length?(function(){if(!e)return;const t=i.map(t=>`\n            <div class="order-item">\n                <div class="order-item-info">\n                    <span class="order-item-name">${t.name}</span>\n                    <span class="order-item-quantity">x${t.quantity}</span>\n                </div>\n                <span class="order-item-price">${t.price*t.quantity} kr</span>\n            </div>\n        `).join("");e.innerHTML=t;const r=m(),s=l(r),c=r+s;n&&(n.textContent=`${r} kr`),o&&(o.textContent=`${s} kr`),a&&(a.textContent=`${c} kr`)}(),t&&t.addEventListener("submit",u),s&&s.addEventListener("click",g),c&&c.addEventListener("click",function(){window.location.href="shop.html"}),r&&r.addEventListener("click",function(t){t.target===r&&g()})):window.location.href="shop.html"});