document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("products-grid"),e=document.getElementById("cart-sidebar"),n=document.getElementById("cart-toggle"),i=document.getElementById("cart-close"),a=document.getElementById("cart-items"),r=document.getElementById("cart-empty"),c=document.getElementById("cart-count"),d=document.getElementById("cart-total-amount"),o=document.getElementById("checkout-btn"),s=document.getElementById("category-filter"),l=document.getElementById("sort-by"),u=[{id:1,name:"Lejon TKD T-shirt",category:"clothing",price:199,originalPrice:249,image:"ü•ã",description:"Officiell Lejon TKD T-shirt i h√∂g kvalitet. Tillg√§nglig i alla storlekar.",badge:"Rea"},{id:2,name:"Taekwondo Dobok",category:"clothing",price:599,originalPrice:null,image:"üëï",description:"Professionell Taekwondo-dr√§kt f√∂r tr√§ning och t√§vling.",badge:null},{id:3,name:"Skyddsv√§st",category:"equipment",price:349,originalPrice:399,image:"ü¶∫",description:"Skyddsv√§st f√∂r t√§vling och tr√§ning. Justerbar f√∂r perfekt passform.",badge:"Rea"},{id:4,name:"Handskydd",category:"equipment",price:199,originalPrice:null,image:"ü•ä",description:"H√∂gkvalitativa handskydd f√∂r optimalt skydd och komfort.",badge:null},{id:5,name:"Fot-skydd",category:"equipment",price:229,originalPrice:null,image:"üëü",description:"L√§ttvikts fot-skydd f√∂r sparring och t√§vling.",badge:null},{id:6,name:"Vit b√§lte",category:"belts",price:89,originalPrice:null,image:"üìø",description:"H√∂gkvalitativt vitt b√§lte f√∂r nyb√∂rjare.",badge:null},{id:7,name:"Arm-skydd",category:"equipment",price:149,originalPrice:null,image:"üìø",description:"Skydd f√∂r armar vid tr√§ning och t√§vling.",badge:null},{id:8,name:"Vattenflaska",category:"accessories",price:79,originalPrice:99,image:"üíß",description:"Lejon TKD vattenflaska med klubblogga. 750ml.",badge:"Rea"}];let g=JSON.parse(localStorage.getItem("lejonTkdCart"))||[],m=[...u];function p(){t&&(t.innerHTML="",0!==m.length?m.forEach(e=>{const n=function(t){const e=document.createElement("div");e.className="product-card";const n=t.badge?`<div class="product-badge">${t.badge}</div>`:"",i=t.originalPrice?`<span class="price-original">${t.originalPrice} kr</span>`:"";return e.innerHTML=`\n            <div class="product-image">\n                ${n}\n                <span class="product-emoji">${t.image}</span>\n            </div>\n            <div class="product-info">\n                <div class="product-category">${function(t){return{clothing:"Kl√§der",equipment:"Utrustning",belts:"B√§lten",accessories:"Tillbeh√∂r"}[t]||t}(t.category)}</div>\n                <h3 class="product-title">${t.name}</h3>\n                <p class="product-description">${t.description}</p>\n                <div class="product-price">\n                    <span class="price-current">${t.price} kr</span>\n                    ${i}\n                </div>\n                <div class="product-actions">\n                    <button class="btn btn-primary btn-small add-to-cart" data-id="${t.id}">\n                        L√§gg i varukorg\n                    </button>\n                </div>\n            </div>\n        `,e}(e);t.appendChild(n)}):t.innerHTML='<p class="no-products">Inga produkter hittades.</p>')}function f(){localStorage.setItem("lejonTkdCart",JSON.stringify(g))}function v(){!function(){if(!c)return;const t=g.reduce((t,e)=>t+e.quantity,0);c.textContent=t}(),function(){if(!a||!r)return;if(0===g.length)return a.innerHTML="",void(r.style.display="block");r.style.display="none",a.innerHTML=g.map(t=>`\n            <div class="cart-item" data-id="${t.id}">\n                <div class="cart-item-image">\n                    <span>${t.image}</span>\n                </div>\n                <div class="cart-item-details">\n                    <div class="cart-item-title">${t.name}</div>\n                    <div class="cart-item-price">${t.price} kr</div>\n                    <div class="cart-item-controls">\n                        <button class="quantity-btn decrease">-</button>\n                        <input type="text" class="quantity-input" value="${t.quantity}" readonly>\n                        <button class="quantity-btn increase">+</button>\n                        <button class="remove-btn" aria-label="Ta bort">üóëÔ∏è</button>\n                    </div>\n                </div>\n            </div>\n        `).join("")}(),function(){if(!d)return;const t=g.reduce((t,e)=>t+e.price*e.quantity,0);d.textContent=`${t} kr`}(),function(){if(!o)return;0===g.length?o.disabled=!0:o.disabled=!1}()}function y(){e.classList.toggle("active")}function b(){e.classList.remove("active")}function k(){const t=s.value;m="all"===t?[...u]:u.filter(e=>e.category===t);L(l.value),p()}function h(){L(l.value),p()}function L(t){switch(t){case"price-low":m.sort((t,e)=>t.price-e.price);break;case"price-high":m.sort((t,e)=>e.price-t.price);break;case"newest":m.sort((t,e)=>e.id-t.id);break;default:m.sort((t,e)=>t.name.localeCompare(e.name))}}document.addEventListener("click",function(t){if(t.target.classList.contains("add-to-cart")){!function(t){const e=u.find(e=>e.id===t);if(!e)return;const n=g.find(e=>e.id===t);n?n.quantity+=1:g.push({...e,quantity:1});f(),v(),function(t){const e=u.find(e=>e.id===t);e&&console.log(`Added ${e.name} to cart`)}(t)}(parseInt(t.target.getAttribute("data-id")))}if(t.target.classList.contains("quantity-btn")){!function(t,e){const n=g.find(e=>e.id===t);if(!n)return;"increase"===e?n.quantity+=1:"decrease"===e&&n.quantity>1&&(n.quantity-=1);f(),v()}(parseInt(t.target.closest(".cart-item").getAttribute("data-id")),t.target.classList.contains("increase")?"increase":"decrease")}if(t.target.classList.contains("remove-btn")){!function(t){g=g.filter(e=>e.id!==t),f(),v()}(parseInt(t.target.closest(".cart-item").getAttribute("data-id")))}}),p(),v(),n&&n.addEventListener("click",y),i&&i.addEventListener("click",b),o&&o.addEventListener("click",function(){window.location.href="checkout.html"}),s&&s.addEventListener("change",k),l&&l.addEventListener("change",h)});