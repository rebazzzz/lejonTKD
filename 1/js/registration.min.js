document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("registration-form"),t=document.getElementById("personal-number"),n=document.getElementById("add-guardian"),r=document.getElementById("guardian-section"),s=document.getElementById("success-modal"),i=document.getElementById("modal-close");document.getElementById("modal-confirm");function o(){const e=function(e){if(!e||e.length<8)return null;const t=parseInt(e.substring(0,4));return(new Date).getFullYear()-t}(t.value.replace(/\D/g,""));if(null!==e&&e<18||n.checked){r.style.display="block";r.querySelectorAll("input").forEach(e=>e.setAttribute("required",""))}else{r.style.display="none";r.querySelectorAll("input").forEach(e=>e.removeAttribute("required"))}}t&&(t.addEventListener("input",o),t.addEventListener("blur",o)),n&&n.addEventListener("change",o),e&&e.addEventListener("submit",function(t){t.preventDefault(),function(){let t=!0;const n=e.querySelectorAll("input, select, textarea");return n.forEach(e=>{l(e)||(t=!1)}),t}()&&(console.log("Form submitted successfully"),s.classList.add("active"),e.reset(),o())}),i&&i.addEventListener("click",function(){s.classList.remove("active")}),s&&s.addEventListener("click",function(e){e.target===s&&s.classList.remove("active")});function l(e){const t=e.value.trim(),n=e.name;document.getElementById(`${n}-error`);if(d(e),e.hasAttribute("required")&&""===t)return u(e,"Detta fält är obligatoriskt"),!1;if("email"===e.type&&""!==t){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return u(e,"Ange en giltig e-postadress"),!1}if("tel"===e.type&&""!==t){if(!/^[\+]?[0-9\s\-\(\)]+$/.test(t))return u(e,"Ange ett giltigt telefonnummer"),!1}if("personal-number"===n&&""!==t){if(!/^\d{8}-\d{4}$/.test(t))return u(e,"Ange personnummer i formatet YYYYMMDD-XXXX"),!1}if("postal-code"===n&&""!==t){if(!/^\d{3}\s?\d{2}$/.test(t))return u(e,"Ange ett giltigt postnummer"),!1}return!0}function u(e,t){const n=e.name,r=document.getElementById(`${n}-error`);r&&(r.textContent=t,r.classList.add("show")),e.style.borderColor="#ff6b6b"}function d(e){const t=e.name,n=document.getElementById(`${t}-error`);n&&(n.textContent="",n.classList.remove("show")),e.style.borderColor=""}e.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("blur",function(){l(this)}),e.addEventListener("input",function(){d(this)})}),t&&t.addEventListener("input",function(e){let t=e.target.value.replace(/\D/g,"");t.length>8&&(t=t.substring(0,8)+"-"+t.substring(8,12)),e.target.value=t});const a=document.getElementById("postal-code");a&&a.addEventListener("input",function(e){let t=e.target.value.replace(/\D/g,"");t.length>3&&(t=t.substring(0,3)+" "+t.substring(3,5)),e.target.value=t})});